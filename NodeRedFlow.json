# WVR
[{"id":"eb952ab9.90bb68","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"23461f5e.0d18d8","type":"http in","z":"eb952ab9.90bb68","name":"","url":"/visualrec","method":"get","upload":false,"swaggerDoc":"","x":120,"y":160,"wires":[["8c8bd3fd.5ac62"]]},{"id":"8c8bd3fd.5ac62","type":"switch","z":"eb952ab9.90bb68","name":"Check Image param","property":"payload.imageurl","propertyType":"msg","rules":[{"t":"null"},{"t":"else"}],"checkall":"false","repair":false,"outputs":2,"x":156,"y":253,"wires":[["196bdd1e.892b23"],["5e6014e8.83eea4","53b5a04d.2f5d98"]]},{"id":"196bdd1e.892b23","type":"template","z":"eb952ab9.90bb68","name":"Get Image URL","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<style>\n    input[type=text] {\n      width: 50em;  height: 3em;\n    }\n    input[type=submit]{\n    background-color: rgb(85,150,230);\n    border: none;\n    color: white;\n    padding: 16px 32px;\n    text-decoration: none;\n    margin: 4px 2px;\n    cursor: pointer;\n    font-size: 15px;\n    border-radius: 10px;\n}\n</style>\n<script type=\"text/javascript\">\nfunction clicked(address) {\n    var form = document.getElementById(\"imageform\");\n\tdocument.getElementById('imageurl').value = address.src;\n\tform.submit();\n}\n</script>\n<h1>Watson Visual Recognition on Node-RED</h1>\n    <h2>Select an Image </h2>\n    <form  action=\"{{req._parsedUrl.pathname}}\" id=\"imageform\">\n        <img src=\"http://grfx.cstv.com/schools/csu/graphics/camsclub/cam_2015.jpg\" height='100' onclick=\"clicked(this)\"/>\n        <img src=\"https://harvesting-history.com/wp-content/uploads/2016/03/The-Brussels-Sprouts.jpg\" height='100' onclick=\"clicked(this)\"/>\n        <img src=\"https://nyppagesix.files.wordpress.com/2017/10/beyonce2.jpg?quality=90&strip=all&w=1236&h=820&crop=1\" height='100' onclick=\"clicked(this)\"/>\n       <!-- <img src=\"\" height='100' onclick=\"clicked(this)\"/> -->\n        <h2>or paste an URL from the internet</h2>\n        <input type=\"text\" name=\"imageurl\" id=\"imageurl\"/><br>\n        <input type=\"submit\" value=\"Analyze\"/>\n    </form>\n   \n   <!-- <h2>or browse from your computer</h2>\n    <form action=\"/classify\" method=\"post\" enctype=\"multipart/form-data\">\n    <input type=\"file\" name=\"pic\" accept=\"image/*\"><br>\n    <input type=\"submit\" value=\"Submit\">\n    </form> -->\n    \n","x":500,"y":160,"wires":[["387d0e9f.82336a"]]},{"id":"8c34b801.ea988","type":"visual-recognition-v3","z":"eb952ab9.90bb68","name":"","apikey":"","vr-service-endpoint":"https://gateway.watsonplatform.net/visual-recognition/api","image-feature":"classifyImage","lang":"en","x":590,"y":320,"wires":[["c4cae67f.51a6c","d179c04.6d146c"]]},{"id":"c4cae67f.51a6c","type":"template","z":"eb952ab9.90bb68","name":"Report","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<style>\nh4 {\n    text-align: center;\n    margin: 10px;\n}\ntable {\n    width: 480px;\n    margin-top: 10px;\n}\nth, td {\n    padding: 8px;\n    text-align: left;\n    border-bottom: 1px solid #ddd;\n    background-color: #FFFFFF;\n    width: 50%;\n}\n.classifier {\n    background-color: rgb(85,150,230);\n    text-align: center;\n}\n.title {\n    background-color:LightGrey;\n}\ninput[type=submit]{\n    background-color: rgb(85,150,230);\n    border: none;\n    color: white;\n    padding: 16px 32px;\n    text-decoration: none;\n    margin: 4px 2px;\n    cursor: pointer;\n    font-size: 15px;\n    border-radius: 10px;\n}\n</style>\n    <div align=\"center\">\n    <form  action=\"{{req._parsedUrl.pathname}}\">\n        <input type=\"submit\" value=\"Try again\"/>\n    </form>\n    <h1>Node-RED Watson Visual Recognition output</h1>\n    <p>Analyzed image: {{req.query.imageurl}}<br/><img src=\"{{req.query.imageurl}}\" height='200'/></p>\n    <p><b>Here are my results:</b></p>\n    {{#result.images}}\n        {{#classifiers}}\n            <table border=\"0\">\n            <tr><td class=classifier colspan=\"2\">{{classifier_id}}</td></tr>\n                <tr><td class=\"title\">Class</td><td class=\"title\">Score</td></tr>\n                {{#classes}}\n                <tr><td><b>{{class}}</b></td><td><i>{{score}}</i></td></tr>\n                {{/classes}}\n            </table>\n        {{/classifiers}}\n    {{/result.images}}\n    </div>\n","x":770,"y":260,"wires":[["387d0e9f.82336a"]]},{"id":"387d0e9f.82336a","type":"http response","z":"eb952ab9.90bb68","name":"HTTP Response","statusCode":"","headers":{},"x":860,"y":160,"wires":[]},{"id":"b3ae1808.820108","type":"debug","z":"eb952ab9.90bb68","name":"P0","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":553,"y":372,"wires":[]},{"id":"d179c04.6d146c","type":"debug","z":"eb952ab9.90bb68","name":"VisRecResult","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":786,"y":372,"wires":[]},{"id":"5e6014e8.83eea4","type":"function","z":"eb952ab9.90bb68","name":"Extract img URL","func":"msg.payload = msg.payload[\"imageurl\"];\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":340,"wires":[["8c34b801.ea988","b3ae1808.820108"]]},{"id":"53b5a04d.2f5d98","type":"debug","z":"eb952ab9.90bb68","name":"P1","active":false,"console":"false","complete":"true","x":502,"y":239,"wires":[]}]
